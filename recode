#!/usr/bin/perl

$tbl{koi} = 'áâ÷çäåöúéêëìíîïğòóôõæèãşûıÿùøüàñÁÂ×ÇÄÅÖÚÉÊËÌÍÎÏĞÒÓÔÕÆÈÃŞÛİßÙØÜÀÑ‚ˆƒ¤·§€¡ †Š‡°½´‘’”„‰…ªº­Œ‹¥¸¨¢¶¦±¾µ¯¼²«»®©¹¬';
$tbl{win} = 'ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏĞÑÒÓÔÕÖ×ØÙÚÛÜİŞßàáâãäåæçèéêëìíîïğñòóôõö÷øùúûüışÿÚÂ¬ÖÒ·¦ÄºÍÃ†´Ç×¶°±²ÛşÀÁÙÓĞ½ÜİŞßÉË»ÕÑ¸ÌÎ¹Æ‡µÈÊ¼ÔÏ¾';
$tbl{alt} = '€‚ƒ„…†‡ˆ‰Š‹Œ‘’“”•–—˜™š›œŸ ¡¢£¤¥¦§¨©ª«¬­®¯àáâãäåæçèéêëìíîïÚÂ¿ÖÒ·³ÄºÍÃÅ´Ç×¶°±²ÛşÀÁÙÓĞ½ÜİŞßÉË»ÕÑ¸ÌÎ¹ÆØµÈÊ¼ÔÏ¾';

$usage = "Usage: $0 -<fromenc>2<toenc> [file_to_decode]
where fromenc and toenc can be koi, win or alt. This script also understands
if it is being run with name <fromenc>2<toenc> (e.g. alt2koi). In this case
it does not check for convert option. If file_to_decode is omitted input is
being taken from stdin. Output always go to stdout.\n";

$0 =~ /(...)2(...)$/ or shift =~ /^-(...)2(...)$/ or die $usage ;
$from = $tbl{lc($1)};
$to = $tbl{lc($2)};
$from or die "Unsupported encoding : $1\n";
$to or die "Unsupported encoding : $2\n";

if($input = shift) {
    open(INPUT, "<$input") or die "Could not open \"$input\" : $!\n";
} else {
    open(INPUT, "<&STDIN") or die "Could not open stdin: $!\n";
}

while(<INPUT>){
    eval "tr/$from/$to/, 1" or die $@;
    print;
}

close(INPUT) or die "Could not close input: $!\n";
